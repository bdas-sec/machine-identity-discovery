{
  "id": "S1-01",
  "name": "Hardcoded Credentials in Source Code",
  "category": "API Keys & Secrets",
  "version": "1.0",
  "description": "Discover and exfiltrate hardcoded credentials from application source code",
  "difficulty": "Easy",
  "real_world_relevance": "Uber breach (2016), countless GitHub secret leaks",

  "mitre_attack": {
    "tactics": ["Credential Access", "Collection"],
    "techniques": [
      {"id": "T1552.001", "name": "Unsecured Credentials: Credentials In Files"},
      {"id": "T1083", "name": "File and Directory Discovery"}
    ]
  },

  "prerequisites": {
    "containers": ["vulnerable-app"],
    "network": "cloud_net"
  },

  "attack_flow": {
    "description": "Attacker discovers hardcoded API keys and database credentials in source files",
    "diagram": [
      "1. Attacker gains access to application source code",
      "2. Attacker searches for common credential patterns",
      "3. Attacker finds hardcoded API keys in config files",
      "4. Attacker extracts and validates credentials",
      "5. Attacker uses credentials to access external services"
    ]
  },

  "phases": [
    {
      "name": "Source Code Access",
      "description": "Access application source files",
      "actions": [
        {
          "type": "file_read",
          "target": "/app/app.py",
          "description": "Read main application source"
        }
      ]
    },
    {
      "name": "Credential Pattern Search",
      "description": "Search for hardcoded secrets using common patterns",
      "actions": [
        {
          "type": "command",
          "command": "grep -rn 'API_KEY\\|SECRET\\|PASSWORD\\|TOKEN' /app/",
          "expected_output_contains": ["AWS_ACCESS_KEY", "DATABASE_PASSWORD"]
        }
      ]
    },
    {
      "name": "Config File Analysis",
      "description": "Extract credentials from configuration files",
      "actions": [
        {
          "type": "http_request",
          "target": "http://172.41.0.20:8888/config",
          "method": "GET",
          "expected_response_contains": ["AWS_ACCESS_KEY_ID", "AWS_SECRET_ACCESS_KEY"]
        }
      ]
    },
    {
      "name": "Credential Exfiltration",
      "description": "Extract and use discovered credentials",
      "critical": true,
      "actions": [
        {
          "type": "command",
          "command": "cat /app/config.py | grep -E '(KEY|SECRET|PASSWORD)'",
          "expected_output_contains": ["AKIAIOSFODNN7EXAMPLE"]
        }
      ]
    }
  ],

  "indicators_of_compromise": [
    {
      "type": "File Access",
      "description": "Suspicious access to configuration files",
      "wazuh_rule": "100600"
    },
    {
      "type": "Process",
      "description": "grep/find commands searching for credential patterns",
      "wazuh_rule": "100601"
    },
    {
      "type": "Network",
      "description": "Outbound connection using discovered credentials",
      "wazuh_rule": "100602"
    }
  ],

  "expected_wazuh_alerts": [
    {
      "rule_id": "100600",
      "level": 7,
      "description": "NHI: Sensitive configuration file access detected"
    },
    {
      "rule_id": "100601",
      "level": 10,
      "description": "NHI: Credential discovery attempt via file search"
    },
    {
      "rule_id": "100900",
      "level": 12,
      "description": "NHI: AWS Access Key pattern detected in logs"
    }
  ],

  "remediation": {
    "immediate": [
      "Rotate all discovered credentials immediately",
      "Audit access logs for credential usage",
      "Scan repositories for additional exposed secrets"
    ],
    "long_term": [
      "Implement secrets management (HashiCorp Vault, AWS Secrets Manager)",
      "Use environment variables for sensitive configuration",
      "Add pre-commit hooks for secret scanning (gitleaks, trufflehog)",
      "Implement CI/CD secret scanning in pipelines"
    ],
    "tools": [
      "gitleaks - Git repository secret scanner",
      "trufflehog - Credential scanner for git history",
      "detect-secrets - Yelp's secret detection tool"
    ]
  },

  "demo_script": {
    "container": "vulnerable-app",
    "commands": [
      "# Search for hardcoded credentials",
      "grep -rn 'API_KEY\\|SECRET\\|PASSWORD' /app/",
      "",
      "# Access exposed config endpoint",
      "curl http://localhost:8888/config"
    ]
  },

  "references": [
    {
      "title": "OWASP - Sensitive Data Exposure",
      "url": "https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/04-Review_Old_Backup_and_Unreferenced_Files_for_Sensitive_Information"
    },
    {
      "title": "MITRE ATT&CK T1552.001",
      "url": "https://attack.mitre.org/techniques/T1552/001/"
    }
  ]
}
