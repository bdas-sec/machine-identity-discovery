title: "NHI: AI Agent SSRF - Cloud Metadata Access"
id: 4f239ceb-d80d-4164-8c57-34c9f1e168c0
related:
    - id: "100853"
      type: derived
status: test
description: |
    Detects AI agent framework processes (including web server runtimes like
    uvicorn, gunicorn, Flask, FastAPI) making requests to cloud metadata
    service endpoints (AWS, GCP, Azure). Expanded process coverage catches
    agents running behind ASGI/WSGI servers.
    Derived from Wazuh rule 100853 (production-grade, child of 100650/100653/100655).
references:
    - https://attack.mitre.org/techniques/T1552/005/
    - https://attack.mitre.org/techniques/T1190/
    - https://owasp.org/www-project-top-10-for-large-language-model-applications/
author: Bodhisattva Das
date: 2026-02-15
modified: 2026-02-16
tags:
    - attack.credential_access
    - attack.initial_access
    - attack.t1552.005
    - attack.t1190
    - nhi.ai_agent
logsource:
    category: network_connection
    product: linux
detection:
    selection_process:
        Image|endswith:
            - '/python'
            - '/python3'
            - '/node'
        Image|contains:
            - 'langchain'
            - 'autogen'
            - 'crewai'
            - 'agent'
            - 'llama'
            - 'vllm'
            - 'ollama'
            - 'uvicorn'
            - 'gunicorn'
            - 'flask'
            - 'fastapi'
    selection_imds_ip:
        dst_ip: '169.254.169.254'
    selection_imds_host:
        DestinationHostname: 'metadata.google.internal'
    condition: 1 of selection_process and (selection_imds_ip or selection_imds_host)
falsepositives:
    - AI applications running on cloud instances that legitimately need instance metadata
level: high
