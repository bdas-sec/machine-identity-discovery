title: "NHI: AI Agent Shell Executing Network/Exfiltration Command"
id: fa4f22b9-4482-4cf7-813d-d9c9a924107a
related:
    - id: "100855"
      type: derived
status: test
description: |
    Detects an AI agent shell subprocess executing network or exfiltration
    commands (curl to IMDS, wget, nc, ssh, scp, rsync). This is an escalation
    of rule 100850 indicating the agent is actively performing network operations
    that could lead to credential theft or data exfiltration.
    Derived from Wazuh rule 100855 (child of 100850).
references:
    - https://attack.mitre.org/techniques/T1059/
    - https://attack.mitre.org/techniques/T1041/
author: Bodhisattva Das
date: 2026-02-16
tags:
    - attack.execution
    - attack.exfiltration
    - attack.t1059
    - attack.t1041
    - nhi.ai_agent
logsource:
    category: process_creation
    product: linux
detection:
    selection_parent:
        ParentImage|endswith:
            - '/python'
            - '/python3'
            - '/node'
        ParentImage|contains:
            - 'langchain'
            - 'autogen'
            - 'crewai'
            - 'agent'
    selection_command:
        CommandLine|contains:
            - 'curl 169.254'
            - 'curl metadata'
            - 'wget 169.254'
            - 'wget metadata'
    selection_tools:
        Image|endswith:
            - '/nc'
            - '/ncat'
            - '/ssh'
            - '/scp'
            - '/rsync'
    condition: 1 of selection_parent and (selection_command or selection_tools)
falsepositives:
    - AI agents legitimately downloading model weights
    - Agents with authorized network access
level: high
