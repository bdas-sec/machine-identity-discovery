title: "NHI: AI Agent SSRF Escalated to Credential Theft Endpoint - CRITICAL"
id: 055ddf27-2364-487e-a547-56f58435a70d
related:
    - id: "100857"
      type: derived
status: test
description: |
    Detects an AI agent SSRF attack that has reached a cloud credential
    endpoint (AWS IAM security-credentials, GCP service account token,
    Azure oauth2/token). This is the critical escalation point where SSRF
    becomes actual credential theft.
    Derived from Wazuh rule 100857 (child of 100853).
references:
    - https://attack.mitre.org/techniques/T1552/005/
    - https://attack.mitre.org/techniques/T1078/004/
author: Bodhisattva Das
date: 2026-02-16
tags:
    - attack.credential_access
    - attack.t1552.005
    - attack.t1078.004
    - nhi.ai_agent
logsource:
    category: network_connection
    product: linux
detection:
    selection_process:
        Image|endswith:
            - '/python'
            - '/python3'
            - '/node'
        Image|contains:
            - 'langchain'
            - 'autogen'
            - 'crewai'
            - 'agent'
            - 'uvicorn'
            - 'gunicorn'
    selection_cred_endpoint:
        url|contains:
            - 'iam/security-credentials'
            - 'service-accounts'
            - 'oauth2/token'
    condition: 1 of selection_process and selection_cred_endpoint
falsepositives:
    - Cloud-native AI applications with legitimate IMDS credential needs
level: critical
