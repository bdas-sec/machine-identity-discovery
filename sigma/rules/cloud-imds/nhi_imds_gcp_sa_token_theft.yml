title: "NHI: GCP Service Account Token Request - Credential Theft"
id: 8f463256-3adb-4024-890e-6fb6b6c91555
related:
    - id: "100654"
      type: derived
status: test
description: |
    Detects requests to the GCP metadata service for service account tokens.
    This combines access to metadata.google.internal with the service-accounts
    token path, indicating active credential theft from GCP instances.
    Derived from Wazuh rule 100654 (child of 100653).
references:
    - https://attack.mitre.org/techniques/T1552/005/
    - https://attack.mitre.org/techniques/T1078/004/
author: Bodhisattva Das
date: 2026-02-15
tags:
    - attack.credential_access
    - attack.t1552.005
    - attack.t1078.004
    - nhi.cloud_imds
logsource:
    category: network_connection
    product: linux
detection:
    selection_gcp:
        DestinationHostname|contains: 'metadata.google.internal'
    selection_sa:
        url|contains|all:
            - 'service-accounts'
            - 'token'
    condition: selection_gcp and selection_sa
falsepositives:
    - GCP SDK automatic credential refresh
    - Application Default Credentials (ADC) resolution
level: high
