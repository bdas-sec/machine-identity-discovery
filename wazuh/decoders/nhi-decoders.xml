<!--
  Non-Human Identity (NHI) Security Decoders
  NDC Security 2026 - "Who Gave the Agent Admin Rights?!"

  Custom decoders for parsing NHI-related log formats.

  Copyright (C) 2026, Bodhisattva Das
-->

<!-- NHI Security Alert Decoder (Flask app security log) -->
<decoder name="nhi_alert">
  <program_name>NHI_ALERT</program_name>
</decoder>

<!-- NHI SSRF URL extractor -->
<decoder name="nhi_alert_url">
  <parent>nhi_alert</parent>
  <regex type="pcre2">SSRF request to (.+?)(?:\s+from|$)</regex>
  <order>url</order>
</decoder>

<!-- IMDS Access Log Decoder -->
<decoder name="nhi-imds-access">
  <prematch>IMDS-ACCESS:|169.254.169.254|mock-imds</prematch>
</decoder>

<!-- Cloud Metadata Service Access -->
<decoder name="nhi-metadata-access">
  <prematch>metadata.google.internal|168.254</prematch>
</decoder>

<!-- Kubernetes Audit Log Decoder -->
<decoder name="nhi-k8s-audit">
  <prematch>audit.k8s.io</prematch>
</decoder>

<!-- ServiceAccount Token Access -->
<decoder name="nhi-sa-token-access">
  <prematch>/var/run/secrets/kubernetes.io/serviceaccount</prematch>
</decoder>

<!-- CI/CD Runner Log Decoder -->
<decoder name="nhi-cicd-runner">
  <prematch>RUNNER:|github-runner|gitlab-runner</prematch>
</decoder>

<!-- AI Agent Activity Decoder -->
<decoder name="nhi-ai-agent">
  <prematch>AI-AGENT:|ai-agent|vulnerable-assistant</prematch>
</decoder>

<!-- Environment Variable Access Decoder -->
<decoder name="nhi-env-access">
  <prematch>/proc/</prematch>
</decoder>

<!-- Secret Pattern Decoder -->
<decoder name="nhi-secret-pattern">
  <prematch>AKIA|ghp_|gho_|sk-|xox</prematch>
</decoder>

<!-- HashiCorp Vault Audit Log Decoder -->
<decoder name="nhi-vault-audit">
  <prematch>vault|X-Vault-Token</prematch>
</decoder>

<!-- Attack Detection Markers -->
<decoder name="nhi-attack-marker">
  <prematch>ATTACK|CRITICAL</prematch>
</decoder>
