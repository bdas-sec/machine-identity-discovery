# NHI Security Testbed - Helm Values
# Default values for nhi-testbed chart (v0.1.0)

# -- Global settings
global:
  # Container image registry prefix (e.g. "ghcr.io/myorg" or "")
  imageRegistry: ""
  imagePullPolicy: IfNotPresent
  # Pull secrets for private registries
  imagePullSecrets: []

# -- Namespace configuration
namespace:
  # Name of the namespace to deploy into
  name: nhi-testbed
  # Create the namespace (set false if it already exists)
  create: true

# ==============================================================================
# Wazuh Stack
# ==============================================================================
wazuh:
  manager:
    enabled: true
    image:
      repository: wazuh/wazuh-manager
      tag: "4.9.2"
    replicas: 1
    ports:
      api: 55000
      agentComm: 1514
      agentEnroll: 1515
      syslog: 514
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: "2"
        memory: 2Gi
    # Wazuh API credentials (use Kubernetes secrets in production)
    credentials:
      apiUser: "wazuh-wui"
      apiPassword: "MyS3cr3tP@ssw0rd"
      indexerUser: "admin"
      indexerPassword: "admin"
    # SSL settings
    ssl:
      verificationMode: "none"

  indexer:
    enabled: true
    image:
      repository: wazuh/wazuh-indexer
      tag: "4.9.2"
    replicas: 1
    port: 9200
    persistence:
      enabled: true
      storageClass: ""
      size: 50Gi
    javaOpts: "-Xms1g -Xmx1g"
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: "2"
        memory: 2Gi

  dashboard:
    enabled: true
    image:
      repository: wazuh/wazuh-dashboard
      tag: "4.9.2"
    port: 5601
    # External port exposed via NodePort or Ingress
    externalPort: 8443
    service:
      type: NodePort
      nodePort: 30443
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: "1"
        memory: 1Gi
    credentials:
      user: "kibanaserver"
      password: "kibanaserver"

# ==============================================================================
# Wazuh Agents
# ==============================================================================
agents:
  cloudWorkload:
    enabled: true
    image:
      repository: nhi-testbed/cloud-workload
      tag: latest
    replicas: 1
    agentName: "cloud-workload-001"
    agentGroup: "cloud,ubuntu,production"
    env:
      CLOUD_PROVIDER: "aws"
      INSTANCE_ID: "i-0abc123def456789"
      INSTANCE_TYPE: "t3.medium"
      AVAILABILITY_ZONE: "us-east-1a"
      IAM_ROLE: "cloud-workload-role"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

  vulnerableApp:
    enabled: true
    image:
      repository: nhi-testbed/vulnerable-app
      tag: latest
    replicas: 1
    port: 8080
    externalPort: 8888
    agentName: "vulnerable-app-001"
    agentGroup: "cloud,vulnerable,demo"
    # Intentionally exposed secrets for demo (ALL FAKE)
    env:
      AWS_ACCESS_KEY_ID: "AKIAIOSFODNN7EXAMPLE"
      AWS_SECRET_ACCESS_KEY: "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
      DATABASE_PASSWORD: "super_secret_password_123"
      API_TOKEN: "ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
      SLACK_WEBHOOK: "https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

  cicdRunner:
    enabled: true
    image:
      repository: nhi-testbed/cicd-runner
      tag: latest
    replicas: 1
    agentName: "cicd-runner-001"
    agentGroup: "cicd,runner,ephemeral"
    env:
      RUNNER_NAME: "github-runner-01"
      RUNNER_TOKEN: "AABCDEFGHIJKLMNOPQRSTUVWXYZ234567"
      GITHUB_TOKEN: "ghp_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
      NPM_TOKEN: "npm_XXXXXXXXXXXXXXXXXXXX"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

# ==============================================================================
# Mock Services
# ==============================================================================
mockServices:
  imds:
    enabled: true
    image:
      repository: nhi-testbed/mock-imds
      tag: latest
    port: 1338
    env:
      MOCK_ACCESS_KEY_ID: "ASIADEMOTESTBED00001"
      MOCK_SECRET_ACCESS_KEY: "wJalrXUtnFEMI_DEMO_IMDS_STOLEN_KEY"
      MOCK_SESSION_TOKEN: "FwoGZXIvYXdzEBYaDEMOTOKENFORTESTING"
      MOCK_ROLE_NAME: "demo-ec2-instance-role"
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 250m
        memory: 128Mi

  gcpMetadata:
    enabled: true
    image:
      repository: nhi-testbed/mock-gcp-metadata
      tag: latest
    port: 1339
    env:
      GCP_PROJECT_ID: "demo-project-12345"
      GCP_PROJECT_NUMBER: "123456789012"
      GCP_SERVICE_ACCOUNT: "demo-compute@demo-project-12345.iam.gserviceaccount.com"
      GCP_ACCESS_TOKEN: "ya29.DEMO_GCP_ACCESS_TOKEN_FOR_TESTING"
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 250m
        memory: 128Mi

  oauth:
    enabled: true
    image:
      repository: nhi-testbed/mock-oauth
      tag: latest
    port: 8090
    env:
      OAUTH_ISSUER: "http://mock-oauth:8090"
      OAUTH_CLIENT_ID: "demo-malicious-app"
      OAUTH_CLIENT_SECRET: "demo-client-secret-FAKE"
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 250m
        memory: 128Mi

  cicd:
    enabled: true
    image:
      repository: nhi-testbed/mock-cicd
      tag: latest
    port: 8080
    env:
      GITHUB_ACTIONS_TOKEN: "ghs_XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
      GITLAB_CI_TOKEN: "glcbt-XXXXXXXXXXXXXXXXXXXX"
      AZURE_DEVOPS_TOKEN: "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
      GITHUB_APP_ID: "12345"
      GITHUB_APP_PRIVATE_KEY_STUB: "demo-private-key"
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 250m
        memory: 128Mi

  vault:
    enabled: true
    image:
      repository: hashicorp/vault
      tag: "1.17"
    port: 8200
    devRootToken: "root-token-for-demo"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

# ==============================================================================
# NHI API (FastAPI)
# ==============================================================================
api:
  enabled: true
  image:
    repository: nhi-testbed/api
    tag: latest
  replicas: 1
  port: 8000
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

# ==============================================================================
# Monitoring Stack
# ==============================================================================
monitoring:
  metrics:
    enabled: true
    image:
      repository: nhi-testbed/metrics-exporter
      tag: latest
    port: 9091
    pollIntervalSeconds: 30
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 250m
        memory: 128Mi

  prometheus:
    enabled: true
    image:
      repository: prom/prometheus
      tag: v2.51.0
    port: 9090
    retention: 7d
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 512Mi

  grafana:
    enabled: true
    image:
      repository: grafana/grafana
      tag: "10.4.0"
    port: 3000
    adminUser: "admin"
    adminPassword: "admin"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

# ==============================================================================
# Optional Profiles
# ==============================================================================
profiles:
  k8sSimulation:
    enabled: false
    nodes:
      - name: "k8s-node-001"
        group: "kubernetes,node,worker"
        nodeName: "k8s-worker-01"
      - name: "k8s-node-002"
        group: "kubernetes,node,worker"
        nodeName: "k8s-worker-02"
    image:
      repository: nhi-testbed/k8s-node
      tag: latest
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

  aiAgent:
    enabled: false
    image:
      repository: nhi-testbed/ai-agent
      tag: latest
    port: 8080
    externalPort: 8889
    agentName: "ai-agent-001"
    agentGroup: "cloud,ai-agent,demo"
    env:
      OPENAI_API_KEY: "sk-demo-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
      ANTHROPIC_API_KEY: "sk-ant-demo-XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
      AGENT_NAME: "vulnerable-assistant"
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 256Mi

# ==============================================================================
# Network Policies
# ==============================================================================
networkPolicies:
  enabled: true
